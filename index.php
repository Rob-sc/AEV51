<?php

$pomodoroHaters = [
    ['~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '~', '~', '0', '0', 'A', '0', 'A', '0', '0', 'A', '0', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '0', '0', '0', '0', '0', '0', 'A', '0', '0', '0', '0', 'A', '0', '~', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '~', '~', '0', '0', '0', '0', '0', 'A', 'A', '0', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '~', '~', '~', '0', '0', '0', '0', '0', 'A', '0', '0', 'A', 'A', 'A', '0', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '0', '0', '0', 'A', '0', 'A', 'A', '0', '0', '0', '0', '0', '0', '0', 'A', '0', '0', '0', 'A', '0', '0', '~'],
    ['~', '~', '~', '~', '~', '~', '0', '0', 'A', '0', '0', '0', 'A', '0', '0', '0', '0', '0', '0', 'A', '0', '0', '0', '~'],
    ['~', '~', '~', '~', '~', '~', '~', '~', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '~'],
    ['~', '~', '~', '~', '~', '0', '0', 'A', '0', '0', '0', '0', '0', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '~', '~', '0', '0', '0', '0', '0', 'A', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '~', '~', '~'],
    ['~', '~', '~', '0', '0', '0', '0', '0', '0', '0', 'A', '0', '0', '0', '0', '0', '0', '0', '0', '~', '~', '~', '~', '~'],
    ['~', '0', '0', '0', '0', '0', '0', '0', '0', 'A', '0', '0', '0', 'A', '0', '0', '0', '0', '0', 'A', '0', '~', '~', '~'],
    ['~', '~', '~', '~', '~', '~', '~', '~', '~', '0', '0', '0', '0', 'A', '0', '0', '~', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '~', '~', '~', '~', '~', '~', '0', '0', '0', 'A', 'A', 'A', '0', '0', 'A', '0', '0', '0', '~', '~', '~'],
    ['~', '~', '~', '~', '0', 'A', 'A', '0', '0', 'A', '0', '0', '0', 'A', '0', '0', '0', '0', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '0', 'A', '0', '0', '0', '~', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '~', '~', '~', '~', '~', '0', '0', '0', 'A', '0', '0', '0', '0', '0', 'A', '0', 'A', '0', '0', '0', '~'],
    ['~', '~', '~', '0', 'A', '0', '0', '0', '0', '0', '0', '0', '0', 'A', '0', '0', '0', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '~', '~', '~', '~', '~', '~', '0', '0', '0', 'A', '0', '0', 'A', '0', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '~', '0', '0', '0', '0', 'A', '0', '0', '0', '0', 'A', '0', '~', '~', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', 'A', '0', '0', '0', '0', '0', '0', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '~', '~', '0', '0', '0', '0', '0', 'A', '0', '0', '0', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~'],
    ['~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~', '~']
];

$impacts = [
    [20, 4],
    [2, 13],
    [13, 12],
    [3, 17],
    [2, 13],
    [5, 19],
    [6, 18],
    [5, 2],
    [20, 13],
    [9, 7],
    [5, 9],
    [15, 16],
    [16, 13],
    [16, 9],
    [16, 0],
    [3, 19],
    [19, 8],
    [1, 16],
    [18, 4],
    [21, 23],
    [7, 17],
    [22, 15],
    [21, 6],
    [14, 8],
    [12, 23],
    [7, 7],
    [22, 4],
    [3, 21],
    [2, 3],
    [8, 11],
    [0, 4],
    [7, 21],
    [11, 4],
    [7, 15],
    [6, 17],
    [5, 19],
    [4, 19],
    [4, 7],
    [23, 21],
    [15, 20],
    [2, 9],
    [21, 2],
    [1, 13],
    [7, 10],
    [21, 5],
    [13, 17],
    [2, 14],
    [11, 14],
    [22, 17],
    [18, 22],
    [2, 23],
    [3, 1],
    [18, 6],
    [17, 12],
    [18, 18],
    [20, 2],
    [3, 14],
    [11, 21],
    [6, 5],
    [6, 2],
    [12, 23],
    [18, 18],
    [21, 6],
    [10, 12],
    [5, 4],
    [16, 19],
    [8, 10],
    [12, 21],
    [15, 1],
    [20, 14],
    [3, 20],
    [6, 19],
    [20, 13],
    [15, 4],
    [10, 2],
    [5, 16],
    [20, 1],
    [12, 13],
    [11, 5],
    [12, 14],
    [8, 3],
    [6, 8],
    [19, 7],
    [16, 9],
    [13, 20],
    [3, 5],
    [1, 0],
    [20, 14],
    [12, 21],
    [12, 16],
    [15, 7],
    [9, 1],
    [1, 18],
    [20, 6],
    [8, 6],
    [22, 1],
    [10, 22],
    [19, 19],
    [7, 16],
    [8, 8]
];

//ESCRIBE AQUÍ TU PROGRAMA PRINCIPAL

function mostrar_mapa($mapa){
    foreach ($mapa as $filas) {
        echo implode('', $filas) . "</br>";
    }
}

function marcar_afectados($mapa, $impactos) {
   
    foreach ($impactos as $impacto) {
        $fila = $impacto[0];
        $columna = $impacto[1]; 

        if (isset($mapa[$fila][$columna]) && $mapa[$fila][$columna] == "A") {
            $mapa[$fila][$columna] = "C";
        }
    }

    return $mapa;
}

function estimar_colirio($mapa) {
    $personas_afectadas = 0;
    
    foreach ($mapa as $fila) {
        foreach ($fila as $celda) {
            if ($celda == "A") {
                $personas_afectadas += 5000;
            }
        }
    }

    $cantidad_colirio_ml = $personas_afectadas * 25;

    $cantidad_colirio_litros = $cantidad_colirio_ml / 1000;

    return [
        'personas_afectadas' => $personas_afectadas,
        'cantidad_colirio_litros' => $cantidad_colirio_litros
    ];
}

function marcar_impactos($mapa, $impactos) {
    foreach ($impactos as $impacto) {
        $fila = $impacto[0];  
        $columna = $impacto[1]; 
        
        if (isset($mapa[$fila][$columna])) {
            if ($mapa[$fila][$columna] == "0") {
                $mapa[$fila][$columna] = "X";
            }
            elseif ($mapa[$fila][$columna] == "~") {
                $mapa[$fila][$columna] = "S";  // Marcar con "S"
            }
        }
    }

    return $mapa;
}

function calcular_danos($mapa) {
    $danos_totales = 0;

    foreach ($mapa as $fila) {
        foreach ($fila as $celda) {
            if ($celda == "A" || $celda == "C") {
                $danos_totales += 200000;
            } elseif ($celda == "0") {
                $danos_totales += 50000;
            }
        }
    }

    return $danos_totales;
}


function calcular_total_mar($mapa) {
    $total_mar = 0;

    foreach ($mapa as $fila) {
        foreach ($fila as $celda) {
            if ($celda == "~") {
                $total_mar++;
            }
        }
    }

    return $total_mar;
}

function calcular_mar_afectado($mapa) {
    $total_mar_afectado = 0;

    foreach ($mapa as $fila) {
        foreach ($fila as $celda) {
            if ($celda == "S") {
                $total_mar_afectado++;
            }
        }
    }

    return $total_mar_afectado;
}

function calcular_bakalao($mapa, $mar_afectado) {
    $total_mar = calcular_total_mar($mapa);

    $total_mar_afectado = calcular_mar_afectado($mar_afectado);

    $toneladas_bakalao_total = 2000;
    
    $toneladas_por_celda = $toneladas_bakalao_total / $total_mar;

    $toneladas_bakalao_afectado = $toneladas_por_celda * $total_mar_afectado;

    return [
        'total_mar' => $total_mar,  
        'total_mar_afectado' => $total_mar_afectado,  
        'toneladas_bakalao_total' => $toneladas_bakalao_total, 
        'toneladas_bakalao_afectado' => $toneladas_bakalao_afectado
    ];
}

function calcular_recaudacion($toneladas_bakalao_afectado, $precio_por_kg = 5) {
    $recaudacion = round($toneladas_bakalao_afectado * 1000 * $precio_por_kg, 2);
    return $recaudacion;
}


$mapa_afectados = marcar_afectados($pomodoroHaters, $impacts);
$mapa_afectado_mar = marcar_impactos($mapa_afectados, $impacts);
$resultado_afectados = estimar_colirio(marcar_afectados($pomodoroHaters, $impacts));
$mapa_mar = calcular_bakalao($mapa_afectados, $mapa_afectado_mar);

//ESCRIBE AQUÍ LA DEFINICIÓN DE LAS FUNCIONES

echo (" MAPA ORIGINAL") ."</br>";

mostrar_mapa($pomodoroHaters); 
// Muestras el mapa recorriendo el array se le pasa a traves de un foreach que transforma 
// cada array que contiene en filas y las muestras a traves de un echo con un br al final 
// para que se visualice correctamente en el navegador.


echo "</br>".(" MAPA CON IMPACTOS URBANOS") ."</br>";
mostrar_mapa($mapa_afectados);
// Recorremos el array de impactos y lo comparamos con el array del mapa a traves del la 
// función isset para buscar una coincidencia donde el valor sea "A" y lo cambiamos a "C"


echo "HAY UN TOTAL DE: " . $resultado_afectados['personas_afectadas'] . " PERSONAS AFECTADAS" . "</br>";
echo "SE NECESITA UN TOTAL DE " . $resultado_afectados['cantidad_colirio_litros'] . "litros DE COLIRIO". "</br>";
// Aqui hemos realizado una cuenta de afectados teniendo en cuenta el mapa de impactos y 
// le hemos aplicado las reglas matemáticas necesarias para obtener los valores de 
// personas afectadas y litros de colirio.


echo "</br>".(" MAPA CON IMPACTOS URBANOS, NO URBANOS Y MAR") ."</br>";
mostrar_mapa(marcar_impactos($mapa_afectados, $impacts) ); 
// En este caso hemos realizado practiamente la misma estrategia que para dectar impactos
// en el mapa Original, pero comparando el nuevo array $mapa_Afectado, en resumen esta función
// permite marcar los impactos en el mapa, modificando las celdas de acuerdo con las reglas 
// especificadas para los territorios no habitados y el mar.


echo "</br>". ("DAÑOS TOTALES"). "</br>";
echo ("HA HABIDO UNOS DAÑOS TOTALES DE: " . calcular_danos($mapa_afectados)) ."€ </br>";
// Con un foreach ($mapa as $fila): Iteramos sobre cada fila del mapa.
// Con un foreach ($fila as $celda): Iteramos sobre cada celda de la fila.
// Si la celda es "A" o "C", sumamos el costo de la zona urbana (200,000€).
// Si la celda es "0", sumamos el costo de la zona no urbana (50,000€).
// Las celdas de mar ("~") y los impactos ("X", "S") no afectan al total, por lo que no se suman.


echo "</br>". ("HAY ") . $mapa_mar['total_mar_afectado']. " AFECTADOS DE UN TOTAL DE " . $mapa_mar['total_mar'] ."km^2 DE MAR"."</br>";
echo "HAY UN TOTAl DE " . $mapa_mar['toneladas_bakalao_total'] ."TONELADAS DE PESCADO AFECTADO </br>";
// Geramos varias funciones para realizar una mapeado completo de la sitaución del mar.
//Función calcular_total_mar:
//Recorre cada celda del mapa y cuenta cuántas celdas contienen "~" (el mar).
//Devuelve el total de celdas de mar.
//
//Función calcular_mar_afectado:
//Recorre cada celda del mapa y cuenta cuántas celdas contienen "S" (el mar afectado).
//Devuelve el total de celdas de mar afectado.
//
//Función calcular_bakalao:
//Calcula el total de mar y el mar afectado utilizando las dos funciones anteriores.
//Utiliza la cantidad total de mar (2000 toneladas de bakalao) para calcular cuántas toneladas de bakalao 
//corresponden a cada celda de mar.Luego calcula cuántas toneladas de bakalao están en el mar afectado.


echo "PODEMOS GANAR: " . calcular_recaudacion($mapa_mar['toneladas_bakalao_afectado'], $precio_por_kg = 5) ."€ VENDIENDO PESCADO </br>";
// Con los valores ya optenidos previamente utilizamos una regla de tres para obtener el resultado
// Además de usar la función round para aproximar los decimales.


?>